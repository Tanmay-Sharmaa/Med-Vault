<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>MedVault | Doctor Dashboard</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(180deg, #f3f9ff 0%, #e6f2ff 100%);
            color: #333;
        }

        .navbar {
            background: linear-gradient(90deg, #0077b6, #00b4d8);
            border-radius: 10px;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar h3 {
            color: #fff;
            font-weight: 700;
        }

        #searchInput {
            border: 2px solid #0d6efd;
            border-radius: 25px;
            padding: 8px 20px;
            font-size: 1rem;
            transition: 0.3s;
        }

        #searchInput:focus {
            box-shadow: 0 0 8px rgba(13,110,253,0.5);
            outline: none;
        }

        .logout-btn {
            background-color: #fff;
            color: #0077b6;
            font-weight: 600;
            border-radius: 25px;
            padding: 6px 20px;
            border: 2px solid #0077b6;
            transition: 0.3s;
        }

        .logout-btn:hover {
            background: #0077b6;
            color: #fff;
            border-color: #fff;
        }

        .card {
            border-radius: 14px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border: none;
            background-color: #fff;
        }

        .table {
            border-radius: 10px;
            overflow: hidden;
        }

        .table thead {
            background-color: #0077b6;
            color: white;
        }

        .table th, .table td {
            text-align: center;
            vertical-align: middle;
        }

        .btn-primary {
            background: linear-gradient(90deg, #0077b6, #00b4d8);
            border: none;
            border-radius: 8px;
            transition: 0.3s;
            font-weight: 500;
        }

        .btn-primary:hover {
            background: linear-gradient(90deg, #005f8f, #0096c7);
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(90deg, #00b894, #00cec9);
            border: none;
            border-radius: 8px;
            transition: 0.3s;
            font-weight: 500;
        }

        .btn-success:hover {
            background: linear-gradient(90deg, #00a182, #00b4a0);
            transform: translateY(-2px);
        }

        .action-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .note-form {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0;
        }

        .note-form textarea {
            resize: none;
            border-radius: 8px;
            font-size: 0.9rem;
            padding: 6px 10px;
            width: 200px;
        }

        footer {
            text-align: center;
            color: #666;
            font-size: 0.9rem;
            margin-top: 40px;
        }
    </style>
</head>
<body class="container mt-4">

<!-- üîπ Navbar -->
<nav class="navbar shadow-sm mb-4">
    <h3>ü©∫ MedVault - Doctor Dashboard</h3>
    <form th:action="@{/logout}" method="post">
        <button type="submit" class="logout-btn">Logout</button>
    </form>
</nav>

<!--  Welcome Alert -->
<div th:if="${param.welcome}" class="alert alert-success text-center" id="welcomeAlert">
    üëã Welcome back, <span th:text="${#authentication.name}">Doctor</span>!
</div>

<!-- üßæ Success Note -->
<div th:if="${param.addedNote}" class="alert alert-success text-center">
    ‚úÖ Doctor note added successfully!
</div>

<!-- Ô∏è Assigned Patients -->
<div class="card p-4">
    <h4 class="mb-3 text-center text-primary">Assigned Patients</h4>
    <p class="text-center text-muted mb-4">View your patients and upload new medical records or notes.</p>

    <!-- üîç Search Bar -->
    <div class="mb-3 text-center">
        <input type="text"
               id="searchInput"
               class="form-control w-50 mx-auto"
               placeholder="üîç Search patient by name or email">
    </div>

    <div class="table-responsive">
        <table class="table table-hover align-middle">
            <thead>
            <tr>
                <th>Patient Name</th>
                <th>Email</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody id="patientTable">
            <tr th:each="dp : ${patients}">
                <td th:text="${dp.patient.name}">Patient Name</td>
                <td th:text="${dp.patient.email}">Email</td>
                <td>
                    <div class="action-wrapper">
                        <a th:href="@{/records/upload/{id}(id=${dp.patient.id})}"
                           th:data-email="${dp.patient.email}"
                           class="btn btn-primary btn-sm">
                            ‚¨ÜÔ∏è Upload Record
                        </a>
                        <form th:action="@{'/doctor/' + ${dp.patient.id} + '/notes'}"
                              method="post" class="note-form">
                            <textarea name="note" rows="1" placeholder="Write a note..." required></textarea>
                            <button class="btn btn-success btn-sm">Add Note</button>
                        </form>
                    </div>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(patients)}">
                <td colspan="3" class="text-muted text-center py-3">
                    No assigned patients found.
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<footer>¬© 2025 MedVault | Secure Health Record System</footer>


<script>
    document.addEventListener("DOMContentLoaded", function () {
        // fade out welcome alert
        const alertBox = document.getElementById("welcomeAlert");
        if (alertBox) {
            setTimeout(() => {
                alertBox.style.transition = "opacity 0.8s ease";
                alertBox.style.opacity = "0";
                setTimeout(() => alertBox.style.display = "none", 800);
            }, 3000);
        }

        // ‚úÖ Fixed Search Logic
        const searchInput = document.getElementById("searchInput");
        const rows = document.querySelectorAll("#patientTable tr");

        searchInput.addEventListener("input", function () {
            const query = this.value.trim().toLowerCase();

            rows.forEach(row => {
                const name = row.querySelector("td:nth-child(1)")?.textContent.toLowerCase() || "";
                const email = row.querySelector("td:nth-child(2)")?.textContent.toLowerCase() || "";

                // Skip the ‚ÄúNo assigned patients‚Äù row
                if (row.querySelector("td[colspan]")) return;

                if (name.includes(query) || email.includes(query)) {
                    row.style.display = "";
                } else {
                    row.style.display = "none";
                }
            });
        });
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
